<!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>AI Document Summarizer</title>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
     <style>
     body { background-color: #f8f9fa; }
     .container { max-width: 800px; }
     .card { margin-top: 2rem; }

     /* Style for the drop zone to span full width */
     #drop-zone {
         display: flex; /* Use flexbox to center content */
         flex-direction: column;
         justify-content: center; /* Center vertically */
         align-items: center; /* Center horizontally */
         border: 2px dashed #0d6efd;
         border-radius: .375rem;
         padding: 40px;
         text-align: center;
         color: #6c757d;
         cursor: pointer;
         transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
         width: 100%; /* Make it full width */
         box-sizing: border-box; /* Include padding and border in the element's total width and height */
     }
     #drop-zone p {
         margin: 0.2rem 0; /* Add a little vertical spacing */
     }
     /* Visual feedback when dragging a file over the zone */
     #drop-zone.drag-over {
         background-color: #e9ecef;
         border-color: #0b5ed7;
     }
     /* Hide the default file input */
     #document-input {
         display: none;
     }
     #loader { display: none; }
 </style>
 </head>
 <body>
     <div class="container">
         <div class="text-center my-4">
             <h1>ðŸ“„ AI Document Summarizer</h1>
             <p class="lead">Drag and drop a .pdf, .docx, or .txt file to get a concise summary.</p>
         </div>

         {% with messages = get_flashed_messages() %}
           {% if messages %}
             <div class="alert alert-danger" role="alert">
               {% for message in messages %}
                 {{ message }}
               {% endfor %}
             </div>
           {% endif %}
         {% endwith %}

         <div class="card">
             <div class="card-body">
                 <form id="upload-form" method="POST" enctype="multipart/form-data" onsubmit="showLoader()">

                     <label for="document-input" id="drop-zone">
                         <p><strong>Drag & Drop a file here</strong></p>
                         <p class="small">or click to select a file</p>
                         <p id="file-name" class="small mt-2 text-success"></p>
                     </label>

                     <input type="file" id="document-input" name="document" required>

                     <div class="d-grid gap-2 mt-3">
                         <button type="submit" class="btn btn-primary">
                             <span id="button-text">Summarize</span>
                             <div class="spinner-border spinner-border-sm ms-2" role="status" id="loader">
                                 <span class="visually-hidden">Loading...</span>
                             </div>
                         </button>
                     </div>
                 </form>

                 {% if summary %}
                     <hr class="my-4">
                     <div>
                         <h5 class="card-title">Summary for: <span class="fw-normal">{{ filename }}</span></h5>
                         <p class="card-text bg-light p-3 rounded" style="white-space: pre-wrap;">{{ summary }}</p>
                         <button class="btn btn-secondary btn-sm" onclick="copySummary()">Copy to Clipboard</button>
                     </div>
                 {% endif %}
             </div>
         </div>

     </div>

     <script>
     const dropZone = document.getElementById('drop-zone');
     const fileInput = document.getElementById('document-input');
     const fileNameDisplay = document.getElementById('file-name');
     const form = document.getElementById('upload-form');

     // --- Drag and Drop Logic ---

     // Prevent default browser behavior for drag events
     ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
         dropZone.addEventListener(eventName, preventDefaults, false);
     });

     function preventDefaults(e) {
         e.preventDefault();
         e.stopPropagation();
     }

     // Add visual feedback when file is dragged over
     ['dragenter', 'dragover'].forEach(eventName => {
         dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-over'), false);
     });

     // Remove visual feedback
     ['dragleave', 'drop'].forEach(eventName => {
         dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-over'), false);
     });

     // Handle the dropped file
     dropZone.addEventListener('drop', handleDrop, false);

     function handleDrop(e) {
         const dt = e.dataTransfer;
         const files = dt.files;

         // Assign the dropped file to our hidden input
         if (files.length > 0) {
             fileInput.files = files;
             // CORRECTED LINE:
             fileNameDisplay.textContent = files[0].name; // Show the selected file name
         }
     }

     // Also handle file selection when clicking the zone
     fileInput.addEventListener('change', () => {
         if (fileInput.files.length > 0) {
             // CORRECTED LINE:
             fileNameDisplay.textContent = fileInput.files[0].name;
         }
     });


     // --- Other Functions ---

     function showLoader() {
         // Only show loader if a file is actually selected
         if(fileInput.files.length > 0) {
             document.getElementById('loader').style.display = 'inline-block';
             document.getElementById('button-text').innerText = 'Processing...';
         }
     }

     function copySummary() {
         // The selector needs to be more specific now
         const summaryText = document.querySelector('.card-text').innerText;
         navigator.clipboard.writeText(summaryText).then(() => {
             alert('Summary copied to clipboard!');
         }).catch(err => {
             console.error('Failed to copy: ', err);
         });
     }
 </script>
 </body>
 </html>



